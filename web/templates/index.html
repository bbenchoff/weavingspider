<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Bohemian Grove Members</title>

  <!-- Bootstrap 5.3 -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
  <!-- DataTables + Bootstrap5 integration -->
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.7/css/dataTables.bootstrap5.min.css">

  <style>
    :root {
      --bg-dark:   #3a1a08;
      --bg-mid:    #5a2d0c;
      --bg-light:  #7a4d1c;
      --bg-tan:    #c8a87a;
      --bg-cream:  #f5ead8;
      --text-dark: #2a1005;
    }

    body {
      background-color: var(--bg-cream);
      color: var(--text-dark);
      font-family: 'Georgia', serif;
    }

    header {
      background: linear-gradient(135deg, var(--bg-dark) 0%, var(--bg-mid) 60%, var(--bg-light) 100%);
      color: #f5ead8;
      padding: 1.5rem 2rem;
      margin-bottom: 1.5rem;
    }
    header h1 {
      font-size: 1.8rem;
      letter-spacing: 0.04em;
      margin-bottom: 0.2rem;
    }
    header p {
      color: var(--bg-tan);
      margin: 0;
      font-size: 0.9rem;
    }

    .stat-card {
      background: var(--bg-mid);
      color: #f5ead8;
      border-radius: 8px;
      padding: 1rem 1.2rem;
      text-align: center;
    }
    .stat-card .stat-num {
      font-size: 2rem;
      font-weight: bold;
      line-height: 1.1;
    }
    .stat-card .stat-label {
      font-size: 0.78rem;
      color: var(--bg-tan);
      text-transform: uppercase;
      letter-spacing: 0.06em;
    }

    .filter-bar {
      background: #fff8f0;
      border: 1px solid var(--bg-tan);
      border-radius: 8px;
      padding: 0.9rem 1.2rem;
      margin-bottom: 1rem;
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 1rem;
    }
    .filter-bar label {
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--bg-mid);
      margin-bottom: 0;
    }

    /* DataTables overrides */
    .dataTables_wrapper .dataTables_filter input {
      border: 1px solid var(--bg-tan);
      border-radius: 4px;
      padding: 0.3rem 0.6rem;
    }
    .dataTables_wrapper .dataTables_length select {
      border: 1px solid var(--bg-tan);
      border-radius: 4px;
    }

    table.dataTable thead th {
      background-color: var(--bg-mid);
      color: #f5ead8;
      border-bottom: 2px solid var(--bg-dark);
      white-space: nowrap;
    }
    table.dataTable thead th:hover {
      background-color: var(--bg-light);
    }
    table.dataTable tbody tr:nth-child(even) {
      background-color: #f0e0c8;
    }
    table.dataTable tbody tr:hover {
      background-color: #e8d0a8 !important;
    }
    table.dataTable tbody tr {
      cursor: pointer;
    }

    /* Modal overrides */
    .modal-header {
      background: var(--bg-mid);
      color: #f5ead8;
    }
    .modal-header .btn-close {
      filter: invert(1);
    }
    .modal-title small {
      font-size: 0.75rem;
      color: var(--bg-tan);
      display: block;
      margin-top: 0.2rem;
    }
    .detail-label {
      font-size: 0.72rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      color: var(--bg-light);
      margin-bottom: 0.15rem;
    }
    .detail-value {
      margin-bottom: 0.9rem;
      word-break: break-word;
    }

    /* Truncate long text cells */
    .cell-truncate {
      max-width: 180px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .badge-employer {
      background-color: var(--bg-mid);
      color: #f5ead8;
      font-size: 0.7rem;
    }
    .badge-donations {
      background-color: #2d6a4f;
      color: #fff;
      font-size: 0.7rem;
    }

    a { color: var(--bg-mid); }
    a:hover { color: var(--bg-dark); }

    footer {
      text-align: center;
      padding: 1.5rem;
      color: #888;
      font-size: 0.8rem;
      margin-top: 2rem;
    }
  </style>
</head>
<body>

<header>
  <h1>Bohemian Grove — Member Research</h1>
  <p>Data compiled from public sources: SEC EDGAR, OpenSecrets, LinkedIn, web biographies</p>
</header>

<div class="container-fluid px-4">

  <!-- Stat cards -->
  <div class="row g-3 mb-4">
    <div class="col-6 col-md-3">
      <div class="stat-card">
        <div class="stat-num">{{ total }}</div>
        <div class="stat-label">Total Members</div>
      </div>
    </div>
    <div class="col-6 col-md-3">
      <div class="stat-card">
        <div class="stat-num">{{ num_camps }}</div>
        <div class="stat-label">Camps</div>
      </div>
    </div>
    <div class="col-6 col-md-3">
      <div class="stat-card">
        <div class="stat-num">{{ with_employer }}</div>
        <div class="stat-label">Employer Identified</div>
      </div>
    </div>
    <div class="col-6 col-md-3">
      <div class="stat-card">
        <div class="stat-num">{{ with_donations }}</div>
        <div class="stat-label">Donation Records</div>
      </div>
    </div>
  </div>

  <!-- Filter bar -->
  <div class="filter-bar">
    <div class="d-flex align-items-center gap-2">
      <label for="campFilter">Camp:</label>
      <select id="campFilter" class="form-select form-select-sm" style="min-width:180px;">
        <option value="">All Camps</option>
        {% for camp in camps %}
        <option value="{{ camp }}">{{ camp }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="d-flex align-items-center gap-2">
      <div class="form-check mb-0">
        <input class="form-check-input" type="checkbox" id="filterEmployer">
        <label class="form-check-label" for="filterEmployer">Has Employer</label>
      </div>
      <div class="form-check mb-0">
        <input class="form-check-input" type="checkbox" id="filterDonations">
        <label class="form-check-label" for="filterDonations">Has Donations</label>
      </div>
    </div>
  </div>

  <!-- Members table -->
  <div class="table-responsive">
    <table id="membersTable" class="table table-sm table-bordered dataTable" style="width:100%">
      <thead>
        <tr>
          <th>Name</th>
          <th>Camp</th>
          <th>Employer</th>
          <th>Title</th>
          <th>Source</th>
          <th>Donations</th>
          <th>NGOs</th>
          <th>Notes</th>
        </tr>
      </thead>
      <tbody>
        {% for m in members %}
        <tr
          data-name="{{ m['name'] | e }}"
          data-camp="{{ m['camp'] | e }}"
          data-employer="{{ m['employer'] | e }}"
          data-title="{{ m['employer_title'] | e }}"
          data-source="{{ m['employer_source'] | e }}"
          data-donations="{{ m['political_donations'] | e }}"
          data-opensecrets="{{ m['opensecrets_url'] | e }}"
          data-ngos="{{ m['ngos'] | e }}"
          data-notes="{{ m['notes'] | e }}"
        >
          <td>{{ m['name'] }}</td>
          <td>{{ m['camp'] }}</td>
          <td>{{ m['employer'] or '' }}</td>
          <td>
            {% if m['employer_title'] %}
            <span class="cell-truncate d-inline-block" title="{{ m['employer_title'] }}">{{ m['employer_title'] }}</span>
            {% endif %}
          </td>
          <td>
            {% if m['employer_source'] %}
            <a href="{{ m['employer_source'] }}" target="_blank" rel="noopener" class="cell-truncate d-inline-block" title="{{ m['employer_source'] }}">link</a>
            {% endif %}
          </td>
          <td>
            {% if m['political_donations'] %}
              {% if m['opensecrets_url'] %}
              <a href="{{ m['opensecrets_url'] }}" target="_blank" rel="noopener" title="{{ m['political_donations'] }}">OpenSecrets</a>
              {% else %}
              <span class="cell-truncate d-inline-block" title="{{ m['political_donations'] }}">{{ m['political_donations'] }}</span>
              {% endif %}
            {% endif %}
          </td>
          <td>
            {% if m['ngos'] %}
            <span class="cell-truncate d-inline-block" title="{{ m['ngos'] }}">{{ m['ngos'] }}</span>
            {% endif %}
          </td>
          <td>
            {% if m['notes'] %}
            <span class="cell-truncate d-inline-block" title="{{ m['notes'] }}">{{ m['notes'] }}</span>
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

</div><!-- /container -->

<!-- Member detail modal -->
<div class="modal fade" id="memberModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title">
          <strong id="modal-name"></strong>
          <small id="modal-camp"></small>
        </div>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div id="modal-employer-section">
          <div class="detail-label">Employer</div>
          <div class="detail-value" id="modal-employer"></div>
          <div class="detail-label">Title</div>
          <div class="detail-value" id="modal-title"></div>
          <div class="detail-label">Source</div>
          <div class="detail-value" id="modal-source"></div>
        </div>
        <div id="modal-donations-section">
          <div class="detail-label">Political Donations</div>
          <div class="detail-value" id="modal-donations"></div>
        </div>
        <div id="modal-ngos-section">
          <div class="detail-label">NGOs / Boards</div>
          <div class="detail-value" id="modal-ngos"></div>
        </div>
        <div id="modal-notes-section">
          <div class="detail-label">Notes</div>
          <div class="detail-value" id="modal-notes"></div>
        </div>
        <div id="modal-empty" class="text-muted fst-italic" style="display:none">
          No additional research data for this member yet.
        </div>
      </div>
    </div>
  </div>
</div>

<footer>
  Bohemian Grove Research &mdash; Data from public sources only
</footer>

<!-- JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.7/js/dataTables.bootstrap5.min.js"></script>

<script>
$(document).ready(function () {

  // Custom filter: employer checkbox
  $.fn.dataTable.ext.search.push(function (settings, data) {
    var needEmployer   = $('#filterEmployer').is(':checked');
    var needDonations  = $('#filterDonations').is(':checked');
    // data[2] = Employer col, data[5] = Donations col
    if (needEmployer  && !data[2].trim()) return false;
    if (needDonations && !data[5].trim()) return false;
    return true;
  });

  var table = $('#membersTable').DataTable({
    pageLength: 50,
    order: [[1, 'asc'], [0, 'asc']],
    columnDefs: [
      { targets: [3, 6, 7], orderable: false }
    ],
    language: {
      search: 'Search all:',
      lengthMenu: 'Show _MENU_ per page',
    }
  });

  // Camp dropdown → filter column 1 (Camp)
  $('#campFilter').on('change', function () {
    var val = $(this).val();
    // Use exact match via regex anchor
    table.column(1).search(val ? '^' + $.fn.dataTable.util.escapeRegex(val) + '$' : '', true, false).draw();
  });

  // Checkbox filters
  $('#filterEmployer, #filterDonations').on('change', function () {
    table.draw();
  });

  // Row click → member detail modal
  $('#membersTable tbody').on('click', 'tr', function () {
    var d = $(this).data();
    var modal = new bootstrap.Modal(document.getElementById('memberModal'));

    $('#modal-name').text(d.name || '');
    $('#modal-camp').text(d.camp ? 'Camp: ' + d.camp : '');

    var hasAny = false;

    // Employer section
    if (d.employer || d.title || d.source) {
      hasAny = true;
      $('#modal-employer').text(d.employer || '—');
      $('#modal-title').text(d.title || '—');
      if (d.source) {
        $('#modal-source').html('<a href="' + $('<div>').text(d.source).html() + '" target="_blank" rel="noopener">' + $('<div>').text(d.source).html() + '</a>');
      } else {
        $('#modal-source').text('—');
      }
      $('#modal-employer-section').show();
    } else {
      $('#modal-employer-section').hide();
    }

    // Donations section
    if (d.donations) {
      hasAny = true;
      var donText = d.donations;
      if (d.opensecrets) {
        $('#modal-donations').html($('<div>').text(donText).html() + ' &mdash; <a href="' + $('<div>').text(d.opensecrets).html() + '" target="_blank" rel="noopener">OpenSecrets</a>');
      } else {
        $('#modal-donations').text(donText);
      }
      $('#modal-donations-section').show();
    } else {
      $('#modal-donations-section').hide();
    }

    // NGOs section
    if (d.ngos) {
      hasAny = true;
      $('#modal-ngos').text(d.ngos);
      $('#modal-ngos-section').show();
    } else {
      $('#modal-ngos-section').hide();
    }

    // Notes section
    if (d.notes) {
      hasAny = true;
      $('#modal-notes').text(d.notes);
      $('#modal-notes-section').show();
    } else {
      $('#modal-notes-section').hide();
    }

    $('#modal-empty').toggle(!hasAny);

    modal.show();
  });

});
</script>

</body>
</html>
